<!DOCTYPE html>
<html lang="nl">
<head>
  <meta http-equiv="cache-control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="expires" content="0">
  <script>
    (function(){
      try {
        const v = Date.now();
        document.addEventListener('DOMContentLoaded', function(){
          document.querySelectorAll('link[rel="stylesheet"][href]').forEach(function(link){
            const href = link.getAttribute('href');
            if (href && href.indexOf('?') === -1) { link.href = href + '?v=' + v; }
          });
          document.querySelectorAll('script[src]').forEach(function(s){
            const src = s.getAttribute('src');
            if (src && src.indexOf('?') === -1) { s.src = src + '?v=' + v; }
          });
        });
      } catch(e) {}
    })();
      // Centraliseer backend helpers via StatusIndicators (indien beschikbaar)
      window.getBackendBase = function(){ try{ return (window.StatusIndicators && StatusIndicators.getBase()) || (localStorage.getItem('backendBase')||'http://localhost:3002'); }catch{ return 'http://localhost:3002'; } }
      window.detectBackend = async function(){
        if (window.StatusIndicators && StatusIndicators.detectBaseOnce){ try{ await StatusIndicators.detectBaseOnce(); }catch{} return StatusIndicators.getBase(); }
        // fallback op bestaande detectiestrategie
        const cands = [getBackendBase(), 'http://localhost:3001','http://localhost:3002'];
        for (const b of [...new Set(cands.map((u)=>String(u).trim().replace(/\/$/,'')))]){
          try{ const r = await fetch(String(b).replace(/\/$/,'')+'/health',{cache:'no-store'}); if (r.ok){ try{ sessionStorage.setItem('backendBase', String(b).replace(/\/$/,'')); }catch{} return String(b).replace(/\/$/,''); } }catch{}
        }
        return String(cands[0]).trim().replace(/\/$/,'');
      }
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Backup Logboek ‚Ä¢ mister.us.kg</title>
  <meta name="robots" content="noindex" />
  <link rel="stylesheet" href="css/style.css?v=20251104-1" />
  <script src="js/status-indicators.js"></script>
  <script src="js/gh-dispatch.js"></script>
  <style>
    /* Admin-aligned palette */
    :root{--bg:#181828;--card:#23234a;--muted:#9ca3af;--fg:#e3e6f0;--accent:#5b21b6;--ok:#22c55e;--warn:#f59e0b;--err:#ef4444}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .container{max-width:860px;margin:0 auto;padding:24px}
    h1{font-size:20px;margin:0 0 12px}
    .sub{color:var(--muted);font-size:13px;margin-bottom:20px}
    .toolbar{display:flex;gap:8px;align-items:center;margin-bottom:14px}
    input,select{background:#1f1f1f;border:1px solid #333;color:var(--fg);padding:8px 10px;border-radius:6px}
  .card{background:var(--card);border:var(--card-border-w,3px) solid var(--card-border-color,#7c3aed);border-radius:var(--card-radius,16px);padding:22px 20px;margin:12px 0;box-shadow:var(--card-shadow,0 4px 16px #0002)}
    .row{display:flex;justify-content:space-between;gap:10px;align-items:center}
  .tag{display:inline-block;padding:2px 10px;border-radius:8px;border:1px solid #333;font-size:12px;color:var(--muted);background:rgba(0,0,0,.15)}
    .tag.ok{color:var(--ok);border-color:#195b37}
    .tag.err{color:var(--err);border-color:#5b1d1d}
    .tag.warn{color:var(--warn);border-color:#5b4a1d}
  .tag.type-backup{color:#4ade80;border-color:#195b37}
  .tag.type-indexbackup{color:#60a5fa;border-color:#1e3a8a}
  .tag.type-workflow{color:#fbbf24;border-color:#5b4a1d}
  .tag.type-note{color:#c084fc;border-color:#4c1d95}
    .ver{font-weight:600}
    .muted{color:var(--muted)}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px}
    .kv{background:#181828;border:1px solid #333;border-radius:8px;padding:10px;font-size:13px}
    .kv .k{color:var(--muted);display:block;margin-bottom:4px}
    .details{margin-top:10px;display:none}
    /* Use global .nav-btn/.admin-btn; only keep .small here */
    .small{font-size:12px}
    .footer{margin-top:20px;color:var(--muted);font-size:12px}
    @media (max-width: 700px){.grid{grid-template-columns:1fr}}

    /* Modal overlay for large JSON/details view */
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.75);-webkit-backdrop-filter:blur(3px);backdrop-filter:blur(3px);display:flex;align-items:center;justify-content:center;z-index:9999}
  .modal{background:#101010;color:#e5e7eb;border:1px solid #333;border-radius:12px;width:92vw;max-width:1200px;max-height:84vh;display:flex;flex-direction:column;overflow:hidden}
    .modal-h{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;background:linear-gradient(135deg,#2563eb,#7c3aed);color:#fff}
    .modal-b{padding:12px;overflow:auto}
  .pre{background:#0b0b0b;border:1px solid #333;border-radius:8px;padding:12px;white-space:pre;overflow:auto;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:12px;line-height:1.45}
    .modal-actions{display:flex;gap:8px;align-items:center}
    /* Utility classes moved from inline styles */
    .hidden{display:none}
    .mb-6{margin-bottom:6px}
    .fw-700{font-weight:700}
    .list-tight{margin:0;padding-left:18px}
    /* Permalink highlight */
    .plink-highlight{animation: ph 2.2s ease-in-out 1}
    @keyframes ph{0%{box-shadow:0 0 0 0 rgba(34,197,94,.8)}30%{box-shadow:0 0 0 6px rgba(34,197,94,.35)}60%{box-shadow:0 0 0 3px rgba(34,197,94,.18)}100%{box-shadow:none}}
  </style>
  <script>
    // Redirect HTTP -> HTTPS when served under mister.us.kg
    (function(){
      try{
        var host = location.hostname;
        if ((/(\.|^)mister\.us\.kg$/i).test(host) && location.protocol === 'http:'){
          location.replace('https://' + host + location.pathname + location.search + location.hash);
        }
      }catch(e){}
    })();
  </script>
</head>
<body>
  <div id="live-banner" class="admin-notification-bar" style="display:none;"></div>
  <div class="container">
    <h1>Backup logboek</h1>
    <div class="sub">Automatisch bijgehouden bij backups en workflows. Deze pagina leest <code>logs/logs.json</code>.</div>
    <div class="toolbar">
      <a href="index.html" class="nav-btn" title="Terug naar Home">‚Üê Home</a>
      <a href="admin.html" class="nav-btn" title="Open Admin">‚öôÔ∏è Admin</a>
    <button class="nav-btn" onclick="location.href=location.pathname+'?v='+Date.now()" title="Harde refresh">‚Üª Refresh</button>
  <button id="runBtn" class="admin-btn" title="Start volledige backup workflow">‚ñ∂ Run workflow</button>
  <button class="admin-btn" title="Start CI via Worker (live)" onclick="GHDispatch.open('ci')">‚ñ∂ CI (live)</button>
    <button id="openLatestBtn" class="admin-btn" title="Scroll naar laatste backup/index">üìå Open laatste backup</button>
      <span id="runStatus" class="small muted"></span>
      <span id="serverSince" class="small muted"></span>
  <input id="search" placeholder="Zoek op versie, type, API..." aria-label="Zoeken in logboek" />
  <select id="type" aria-label="Filter op type">
        <option value="">Alle types</option>
        <option>workflow</option>
        <option>backup</option>
        <option>indexBackup</option>
        <option>note</option>
      </select>
    </div>
    
    <!-- Changelog (compact) -->
    <div id="changelog" class="card hidden">
      <div class="row mb-6">
        <div class="fw-700">Changelog</div>
        <div class="small muted">Laatste wijzigingen (type: note)</div>
      </div>
      <ul id="changelog-list" class="list-tight"></ul>
    </div>
    <div id="list"></div>
    <div class="footer">Tip: draai <code>full-backup-workflow.ps1</code> voor een volledige workflow entry met API- en cloudstatus.</div>
  </div>
  <script>
  // Toon LIVE banner wanneer omgeving=live
  (function(){
    function updateLiveBanner(){
      try{
        var bar = document.getElementById('live-banner');
        if (!bar) return;
        var isLive = (window.StatusIndicators && StatusIndicators.getEnvMode && StatusIndicators.getEnvMode()==='live');
        if (isLive){
          bar.style.display = 'block';
          bar.className = 'admin-notification-bar info';
          bar.innerHTML = 'LIVE omgeving actief ‚Äî lokale workflow starten is uitgeschakeld. <a href="live-tools.html" style="color:#4ade80;text-decoration:underline">Open Live Tools</a>';
          try{ const rb = document.getElementById('runBtn'); if (rb) rb.disabled = true; const rs = document.getElementById('runStatus'); if (rs) { rs.style.color = '#9ca3af'; rs.textContent = 'Live modus: workflow niet beschikbaar.'; } }catch{}
        } else {
          bar.style.display = 'none';
          bar.textContent = '';
        }
      }catch{}
    }
    document.addEventListener('DOMContentLoaded', updateLiveBanner);
    setInterval(updateLiveBanner, 5000);
  })();

  const elList = document.getElementById('list');
  const elSearch = document.getElementById('search');
  const elType = document.getElementById('type');
  const elOpenLatest = document.getElementById('openLatestBtn');
  const runBtn = document.getElementById('runBtn');
  const runStatus = document.getElementById('runStatus');
  let entries = [];

  // --- Backend base helpers (reuse same keys as index.html) ---
  function normBase(u){ try{ return String(u||'').trim().replace(/\/$/,''); } catch{ return 'http://localhost:3001'; } }
  function getBackendBase(){
    try{
      const ls = localStorage.getItem('backendBase')||'';
      const ss = sessionStorage.getItem('backendBase')||'';
      return normBase(ls||ss||'http://localhost:3002');
    }catch{ return 'http://localhost:3001'; }
  }
  async function detectBackend(){
    const cands = [getBackendBase(), 'http://localhost:3001','http://localhost:3002'];
    for (const b of [...new Set(cands.map(normBase))]){
      try{ const r = await fetch(normBase(b)+'/health',{cache:'no-store'}); if (r.ok){ try{ sessionStorage.setItem('backendBase', normBase(b)); }catch{} return normBase(b);} }catch{}
    }
    return normBase(cands[0]);
  }

  async function checkBackendHealth(){
    try{
      const ctrl = new AbortController();
      const t = setTimeout(()=>ctrl.abort(), 4000);
      const base = await detectBackend();
      const res = await fetch(base.replace(/\/$/,'') + '/health', { signal: ctrl.signal });
      clearTimeout(t);
      if (!res.ok) throw new Error('HTTP '+res.status);
      const j = await res.json().catch(()=>({}));
      if (runBtn) runBtn.disabled = false;
      if (runStatus) { runStatus.textContent = 'backend online ‚Ä¢ '+base; runStatus.style.color = '#22c55e'; }
      try{
        const ss = document.getElementById('serverSince');
        if (ss && j && j.startedAt){
          const d = new Date(j.startedAt);
          ss.textContent = 'server sinds: '+ d.toLocaleString();
        }
      }catch{}
    }catch(e){
      if (runBtn) runBtn.disabled = true;
      if (runStatus) { runStatus.textContent = 'backend offline'; runStatus.style.color = '#ef4444'; }
      try{ const ss = document.getElementById('serverSince'); if (ss) ss.textContent = ''; }catch{}
    }
  }

  function fmt(ts){ try { return new Date(ts).toLocaleString(); } catch { return ts; } }
  function tag(txt, cls=''){ return '<span class="tag '+cls+'">'+txt+'</span>'; }

  function latestBackupIndex(){
    try{
      if (!Array.isArray(entries) || !entries.length) return -1;
      // voorkeur: item met artifacts.indexBackup of artifacts.zip; type backup/indexBackup
      const preferred = entries
        .map((e,i)=>({e,i}))
        .filter(x=>{
          const t = String(x.e.type||'').toLowerCase();
          const art = x.e.artifacts||{};
          return (t==='backup' || t==='indexbackup' || art.indexBackup || art.zip);
        })
        .sort((a,b)=> new Date(b.e.timestamp)-new Date(a.e.timestamp));
      return preferred.length ? preferred[0].i : -1;
    }catch{ return -1; }
  }

  function linkifyMaybe(v){
    try{ const s=String(v||''); if(/^https?:\/\//i.test(s)){ return '<a href="'+s+'" target="_blank" rel="noopener">'+s+'</a>'; } return s||'-'; }catch{ return v||'-'; }
  }

  function render(){
    const q = (elSearch.value||'').toLowerCase();
    const t = elType.value;
    let data = entries.slice().sort((a,b)=> new Date(b.timestamp)-new Date(a.timestamp));
    if (t) data = data.filter(e=>e.type===t);
    if (q) data = data.filter(e=>JSON.stringify(e).toLowerCase().includes(q));
  elList.innerHTML = data.map((e, idx)=>{
      const site = e.site||{}; const apis = e.apis||{}; const git = e.git||{}; const art=e.artifacts||{};
      const okTag = site.online ? tag('online','ok') : tag('offline','err');
      const typeClass = 'type-'+String(e.type||'').toLowerCase();
      const typeTag = tag(e.type||'-', typeClass);
      const ver = '<span class="ver">'+(e.versionTag||'-')+'</span>';
      const head = [
        '<div class="row">',
        '  <div>'+ver+' '+typeTag+' <span class="muted">'+fmt(e.timestamp)+'</span></div>',
        '  <div>'+okTag+'</div>',
        '</div>'
      ].join('');
      const grid = [
        '<div class="grid">',
        '  <div class="kv"><span class="k">ZIP</span>'+linkifyMaybe(art.zip)+'</div>',
        '  <div class="kv"><span class="k">Index backup</span>'+linkifyMaybe(art.indexBackup)+'</div>',
        '  <div class="kv"><span class="k">Site status</span>'+(site.status||'-')+' @ '+linkifyMaybe(site.url)+'</div>',
        '  <div class="kv"><span class="k">Formspree</span>'+((apis.formspree&&apis.formspree.status)||'-')+' '+(apis.formspree&&apis.formspree.url?('<span class="muted small">('+linkifyMaybe(apis.formspree.url)+')</span>'):'')+'</div>',
        '  <div class="kv"><span class="k">Ably Auth</span>'+((apis.ablyAuth&&apis.ablyAuth.status)||'-')+' '+(apis.ablyAuth&&apis.ablyAuth.url?('<span class="muted small">('+linkifyMaybe(apis.ablyAuth.url)+')</span>'):'')+'</div>',
        '  <div class="kv"><span class="k">Git</span>'+(git.sha||'-')+' <span class="muted small">'+(git.message||'')+'</span></div>',
        '</div>'
      ].join('');
      const permalink = '?ts='+encodeURIComponent(e.timestamp);
      const tsId = 'log-'+String(e.timestamp||'').replace(/[^0-9A-Za-z:._-]/g,'');
      const btns = '<div>'
        + '<button class="nav-btn small" onclick="viewEntryDetails('+idx+')">Details</button> '
        + '<a class="nav-btn small" href="'+permalink+'" title="Open deze entry via permalink">Permalink</a>'
        + '</div>';
      return '<div class="card" id="'+tsId+'">'+head+grid+btns+'</div>';
    }).join('');
  }

  function renderChangelog(){
    try{
      const box = document.getElementById('changelog');
      const ul = document.getElementById('changelog-list');
      if (!box || !ul) return;
      function decodeM(s){
        try{
          if (!s) return s;
          const str = String(s);
          if (!(/[√É√Ç√¢‚Ç¨‚Ñ¢‚Äú‚Äù‚Ç¨¬¢]/.test(str))) return str;
          let t = '';
          try { t = decodeURIComponent(escape(str)); } catch { t = str; }
          const map = {
            '√¢‚Ç¨‚Ñ¢': '‚Äô', '√¢‚Ç¨Àú': '‚Äò', '√¢‚Ç¨≈ì': '‚Äú', '√¢‚Ç¨ÔøΩ': '‚Äù', '√¢‚Ç¨‚Äú': '‚Äì', '√¢‚Ç¨‚Äù': '‚Äî',
            '√É¬©': '√©', '√É¬´': '√´', '√É¬®': '√®', '√É¬™': '√™', '√É¬∂': '√∂', '√É¬º': '√º', '√É¬§': '√§',
            '√É¬°': '√°', '√É¬†': '√†', '√É¬≥': '√≥', '√É¬±': '√±', '√É¬ß': '√ß', '√É¬≠': '√≠', '√É¬∫': '√∫',
            '√Ç ': ' ', '√Ç': ''
          };
          let out = t;
          for (const k in map){ out = out.split(k).join(map[k]); }
          return out;
        }catch{ return s; }
      }
      // Pick last 5 note entries, prefer versionTag starting with 'ui-' or 'change'
      const notes = (entries||[])
        .filter(e=>e && e.type==='note')
        .sort((a,b)=> ((b.pinned===true)-(a.pinned===true)) || (new Date(b.timestamp)-new Date(a.timestamp)));
      const preferred = notes.filter(e=>String(e.versionTag||'').startsWith('ui-') || String(e.versionTag||'').startsWith('change'));
      const source = (preferred.length ? preferred : notes).slice(0,5);
      if (!source.length){ box.style.display='none'; return; }
      box.style.display='block';
      ul.innerHTML = source.map((e, idx)=>{
        const title = (e.versionTag||'note')+' ¬∑ '+fmt(e.timestamp)+(e.pinned?' ¬∑ üìå':'');
        const msg = decodeM((e.message||'')).split('\n')[0];
        const indexInAll = entries.indexOf(e);
        return '<li><a href="#" onclick="viewEntryDetails('+indexInAll+');return false;" class="small">'+title+'</a>'+(msg?'<div class="muted small">'+msg.replace(/</g,'&lt;')+'</div>':'')+'</li>';
      }).join('');
    }catch{}
  }

  async function load(){
    try{
      const res = await fetch('logs/logs.json?ts='+Date.now());
      const json = await res.json();
      entries = Array.isArray(json.entries)? json.entries : [];
    }catch(e){ entries = []; }
    render();
    renderChangelog();
    try{
      // Enable 'Open laatste backup' knop
      if (elOpenLatest){
        const idx = latestBackupIndex();
        elOpenLatest.disabled = idx < 0;
      }
    }catch{}
    try{
      const sp = new URLSearchParams(location.search);
      const qts = sp.get('ts');
      if (qts){
        const idx = entries.findIndex(e=> String(e && e.timestamp) === qts);
        if (idx >= 0){
          const id = 'log-'+String(qts).replace(/[^0-9A-Za-z:._-]/g,'');
          const el = document.getElementById(id);
          if (el){
            el.scrollIntoView({ behavior: 'smooth', block: 'start' });
            el.classList.add('plink-highlight');
            setTimeout(()=>el.classList.remove('plink-highlight'), 2400);
          }
          setTimeout(()=>viewEntryDetails(idx), 200);
        }
      }
    }catch{}
  }

  async function runWorkflow(){
    try{
      runStatus.textContent = 'workflow starten‚Ä¶';
      const ctrl = new AbortController();
      const t = setTimeout(()=>ctrl.abort(), 120000);
      const base = await detectBackend();
      const res = await fetch(base.replace(/\/$/,'') + '/workflow/run', {
        method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ quick:true }), signal: ctrl.signal
      });
      clearTimeout(t);
      if(!res.ok) throw new Error('HTTP '+res.status);
      const j = await res.json().catch(()=>({}));
      runStatus.textContent = 'klaar (exit '+((j.exitCode!=null)?j.exitCode:0)+') ‚Ä¢ '+base;
      setTimeout(load, 800);
    }catch(e){ runStatus.textContent = 'fout: '+(e.message||e); }
  }

  if (runBtn) runBtn.addEventListener('click', runWorkflow);
  elSearch.addEventListener('input', render);
  elType.addEventListener('change', render);
  if (elOpenLatest) elOpenLatest.addEventListener('click', ()=>{
    const idx = latestBackupIndex();
    if (idx >= 0){
      const e = entries[idx];
      const id = 'log-'+String(e.timestamp||'').replace(/[^0-9A-Za-z:._-]/g,'');
      const el = document.getElementById(id);
      if (el){ el.scrollIntoView({ behavior:'smooth', block:'start' }); el.classList.add('plink-highlight'); setTimeout(()=>el.classList.remove('plink-highlight'), 2400); }
      setTimeout(()=>viewEntryDetails(idx), 250);
    }
  });

  load();
  checkBackendHealth();
  // Periodiek bijwerken server-sinds
  setInterval(checkBackendHealth, 12000);

  // Large modal with message + raw JSON
  window.viewEntryDetails = function(idx){
    const e = (entries||[])[idx];
    if (!e) return;
    function decodeM(s){
      try{
        if (!s) return s;
        const str = String(s);
        if (!(/[√É√Ç√¢‚Ç¨‚Ñ¢‚Äú‚Äù‚Ç¨¬¢]/.test(str))) return str;
        let t = '';
        try { t = decodeURIComponent(escape(str)); } catch { t = str; }
        const map = {
          '√¢‚Ç¨‚Ñ¢': '‚Äô', '√¢‚Ç¨Àú': '‚Äò', '√¢‚Ç¨≈ì': '‚Äú', '√¢‚Ç¨ÔøΩ': '‚Äù', '√¢‚Ç¨‚Äú': '‚Äì', '√¢‚Ç¨‚Äù': '‚Äî',
          '√É¬©': '√©', '√É¬´': '√´', '√É¬®': '√®', '√É¬™': '√™', '√É¬∂': '√∂', '√É¬º': '√º', '√É¬§': '√§',
          '√É¬°': '√°', '√É¬†': '√†', '√É¬≥': '√≥', '√É¬±': '√±', '√É¬ß': '√ß', '√É¬≠': '√≠', '√É¬∫': '√∫',
          '√Ç ': ' ', '√Ç': ''
        };
        let out = t;
        for (const k in map){ out = out.split(k).join(map[k]); }
        return out;
      }catch{ return s; }
    }
    const overlay = document.createElement('div');
    overlay.className = 'overlay';
    const modal = document.createElement('div');
    modal.className = 'modal';
    const head = document.createElement('div');
    head.className = 'modal-h';
    const title = document.createElement('div');
    title.style.fontWeight = '800';
    title.textContent = (e.versionTag||'-')+' ‚Ä¢ '+(e.type||'-')+' ‚Ä¢ '+fmt(e.timestamp);
    const acts = document.createElement('div');
    acts.className = 'modal-actions';
  const btnCopy = document.createElement('button'); btnCopy.className = 'nav-btn'; btnCopy.textContent = 'Kopieer JSON';
    btnCopy.onclick = ()=>{ try{ navigator.clipboard.writeText(JSON.stringify(e,null,2)); btnCopy.textContent='Gekopieerd'; setTimeout(()=>btnCopy.textContent='Kopieer JSON',1200);}catch{} };
  const permalink = (location.origin||'') + location.pathname + '?ts=' + encodeURIComponent(e.timestamp);
  const btnPermalink = document.createElement('button'); btnPermalink.className = 'nav-btn'; btnPermalink.textContent = 'Permalink';
  btnPermalink.onclick = ()=>{ try{ navigator.clipboard.writeText(permalink); btnPermalink.textContent='Gekopieerd'; setTimeout(()=>btnPermalink.textContent='Permalink',1200);}catch{} };
  const btnClose = document.createElement('button'); btnClose.className = 'nav-btn'; btnClose.textContent = 'Sluiten'; btnClose.onclick = ()=> overlay.remove();
  acts.appendChild(btnCopy); acts.appendChild(btnPermalink); acts.appendChild(btnClose);
    head.appendChild(title); head.appendChild(acts);

    const body = document.createElement('div'); body.className = 'modal-b';
  if (e.message) { const m = document.createElement('div'); m.className='pre'; m.style.marginBottom='10px'; m.textContent = String(decodeM(e.message||'')); body.appendChild(m); }
    const pre = document.createElement('pre'); pre.className='pre'; pre.textContent = JSON.stringify(e,null,2); body.appendChild(pre);

    modal.appendChild(head); modal.appendChild(body); overlay.appendChild(modal);
    overlay.addEventListener('click', (ev)=>{ if (ev.target === overlay) overlay.remove(); });
    document.body.appendChild(overlay);
  }
  </script>
</body>
</html>
